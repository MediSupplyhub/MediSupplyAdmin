<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediSupply Admin CMS</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #333; }
        
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .login-box h2 { text-align: center; margin-bottom: 30px; color: #2c3e50; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 14px; }
        .btn { padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.3s; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #219a52; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #d68910; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; }
        .alert { padding: 10px; border-radius: 4px; margin-bottom: 15px; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .hidden { display: none; }
        .toggle-text { text-align: center; margin-top: 15px; color: #666; }
        .toggle-link { color: #3498db; cursor: pointer; text-decoration: underline; }
        
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: #2c3e50; color: white; padding: 20px 0; }
        .logo { text-align: center; padding: 20px; border-bottom: 1px solid #34495e; margin-bottom: 20px; }
        .logo h1 { font-size: 1.5rem; color: #3498db; }
        .nav-links { list-style: none; }
        .nav-links li { padding: 15px 25px; cursor: pointer; transition: background 0.3s; }
        .nav-links li:hover { background: #34495e; }
        .nav-links li.active { background: #3498db; border-left: 4px solid #2980b9; }
        .main-content { flex: 1; padding: 20px; overflow-y: auto; }
        .header { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 10px; }
        .stat-card .number { font-size: 2rem; font-weight: bold; color: #2c3e50; }
        .content-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ecf0f1; }
        .data-table th { background: #f8f9fa; font-weight: 600; color: #2c3e50; }
        .data-table tr:hover { background: #f8f9fa; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h3 { margin: 0; }
        .close { font-size: 24px; cursor: pointer; }
        
        .form-actions { display: flex; gap: 10px; margin-top: 20px; }
        .search-box { margin-bottom: 15px; display: flex; gap: 10px; }
        .search-box input { flex: 1; }
        
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }
        .status-active { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        .status-admin { background: #3498db; color: white; }
        .status-user { background: #95a5a6; color: white; }
        
        .loading { text-align: center; padding: 20px; color: #7f8c8d; }
        .error { text-align: center; padding: 20px; color: #e74c3c; }
        .user-details { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div id="loginFormContainer">
                <h2>MediSupply Admin Login</h2>
                <div id="loginMessage" class="alert hidden"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login to Admin Panel</button>
                </form>
                <div class="toggle-text">
                    Don't have an admin account? <span class="toggle-link" onclick="showRegister()">Create one</span>
                </div>
            </div>

            <div id="registerFormContainer" class="hidden">
                <h2>Create Admin Account</h2>
                <div id="registerMessage" class="alert hidden"></div>
                <form id="registerForm">
                    <div class="form-group">
                        <label>Admin Email:</label>
                        <input type="email" id="regEmail" class="form-control" required placeholder="admin@yourcompany.com">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="regPassword" class="form-control" required placeholder="Minimum 6 characters">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password:</label>
                        <input type="password" id="regConfirmPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Create Admin Account</button>
                </form>
                <div class="toggle-text">
                    Already have an account? <span class="toggle-link" onclick="showLogin()">Login here</span>
                </div>
            </div>
        </div>
    </div>

    <div id="adminDashboard" class="container hidden">
        <div class="sidebar">
            <div class="logo">
                <h1>MediSupply CMS</h1>
            </div>
            <ul class="nav-links">
                <li class="active" onclick="showSection('dashboard')">ðŸ“Š Dashboard</li>
                <li onclick="showSection('users')">ðŸ‘¥ User Management</li>
                <li onclick="showSection('products')">ðŸ“¦ Product Management</li>
                <li onclick="showSection('orders')">ðŸ›’ Order Management</li>
                <li onclick="showSection('notifications')">ðŸ”” Send Notifications</li>
                <li onclick="logout()">ðŸšª Logout</li>
            </ul>
        </div>

        <div class="main-content">
            <div class="header">
                <h2 id="sectionTitle">Dashboard</h2>
                <div>
                    <span id="userEmail"></span>
                    <button onclick="logout()" class="btn btn-danger" style="margin-left: 15px;">Logout</button>
                </div>
            </div>

            <div id="dashboardSection" class="section-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <div class="number" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="number" id="totalProducts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="number" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Revenue</h3>
                        <div class="number" id="totalRevenue">$0</div>
                    </div>
                </div>

                <div class="content-section">
                    <h3>Recent Orders</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrders">
                            <tr><td colspan="6" class="loading">Loading recent orders...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="usersSection" class="section-content hidden">
                <div class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>User Management</h3>
                        <button onclick="showAddUserModal()" class="btn btn-primary">Add New User</button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="userSearch" class="form-control" placeholder="Search users by name or email..." onkeyup="searchUsers()">
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr><td colspan="6" class="loading">Loading users...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="productsSection" class="section-content hidden">
                <div class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Product Management</h3>
                        <button onclick="showAddProductModal()" class="btn btn-primary">Add New Product</button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="productSearch" class="form-control" placeholder="Search products by name..." onkeyup="searchProducts()">
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <tr><td colspan="6" class="loading">Loading products...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="ordersSection" class="section-content hidden">
                <div class="content-section">
                    <h3>Order Management</h3>
                    
                    <div class="search-box">
                        <input type="text" id="orderSearch" class="form-control" placeholder="Search orders by customer name..." onkeyup="searchOrders()">
                        <select id="orderStatusFilter" class="form-control" onchange="filterOrders()" style="width: 200px;">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <tr><td colspan="8" class="loading">Loading orders...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="notificationsSection" class="section-content hidden">
                <div class="content-section">
                    <h3>Send Notifications</h3>
                    <p>Send messages to users that will appear in their notification modal in the app.</p>
                    
                    <form id="notificationForm">
                        <div class="form-group">
                            <label>Send To:</label>
                            <select id="notificationRecipient" class="form-control" onchange="toggleUserSelection()">
                                <option value="all">All Users</option>
                                <option value="single">Single User</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="userSelectionContainer" style="display: none;">
                            <label>Select User:</label>
                            <select id="notificationUser" class="form-control">
                                <option value="">Loading users...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Notification Title:</label>
                            <input type="text" id="notificationTitle" class="form-control" required placeholder="Important Update">
                        </div>
                        
                        <div class="form-group">
                            <label>Notification Message:</label>
                            <textarea id="notificationMessage" class="form-control" rows="4" required placeholder="Enter your message here..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Notification Type:</label>
                            <select id="notificationType" class="form-control">
                                <option value="info">Information</option>
                                <option value="warning">Warning</option>
                                <option value="success">Success</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Send Notification</button>
                    </form>
                </div>

                <div class="content-section">
                    <h3>Recent Notifications</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Message</th>
                                <th>Recipient</th>
                                <th>Type</th>
                                <th>Sent At</th>
                            </tr>
                        </thead>
                        <tbody id="notificationsTable">
                            <tr><td colspan="5" class="loading">Loading notifications...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Add New User</h3>
                <span class="close" onclick="closeUserModal()">&times;</span>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Display Name:</label>
                    <input type="text" id="userDisplayName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="userEmailInput" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="userRole" class="form-control" required>
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group" id="passwordField">
                    <label>Password:</label>
                    <input type="password" id="userPassword" class="form-control" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save User</button>
                </div>
            </form>
        </div>
    </div>

    <div id="userDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Details</h3>
                <span class="close" onclick="closeUserDetailsModal()">&times;</span>
            </div>
            <div id="userDetailsContent"></div>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add New Product</h3>
                <span class="close" onclick="closeProductModal()">&times;</span>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label>Product Name:</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="productDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Price ($):</label>
                    <input type="number" id="productPrice" class="form-control" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Stock Quantity:</label>
                    <input type="number" id="productStock" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label>Category:</label>
                    <input type="text" id="productCategory" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Image URL:</label>
                    <input type="url" id="productImage" class="form-control" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProductModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Order Details</h3>
                <span class="close" onclick="closeOrderModal()">&times;</span>
            </div>
            <div id="orderDetails"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBpTZhmKk-wW7lSVLq-xiMDCV1X2bvYk94",
            authDomain: "medisupplyapp-273ed.firebaseapp.com",
            projectId: "medisupplyapp-273ed",
            storageBucket: "medisupplyapp-273ed.appspot.com",
            messagingSenderId: "661546659239",
            appId: "1:661546659239:web:da2b94b3957a821885a82"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const loginScreen = document.getElementById('loginScreen');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginMessage = document.getElementById('loginMessage');
        const registerMessage = document.getElementById('registerMessage');
        const userEmail = document.getElementById('userEmail');

        let users = [];
        let products = [];
        let orders = [];
        let currentEditingId = null;

        function showRegister() {
            document.getElementById('loginFormContainer').classList.add('hidden');
            document.getElementById('registerFormContainer').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registerFormContainer').classList.add('hidden');
            document.getElementById('loginFormContainer').classList.remove('hidden');
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'alert alert-' + type;
            element.classList.remove('hidden');
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                showMessage('registerMessage', 'Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('registerMessage', 'Password must be at least 6 characters', 'error');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                await db.collection('users').doc(user.uid).set({
                    email: email,
                    role: 'admin',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    displayName: 'Admin User'
                });

                showMessage('registerMessage', 'Admin account created successfully!', 'success');
                
                setTimeout(() => {
                    showLogin();
                    document.getElementById('email').value = email;
                    showMessage('loginMessage', 'Account created! You can now login.', 'success');
                }, 2000);

            } catch (error) {
                console.error('Registration error:', error);
                showMessage('registerMessage', 'Registration failed: ' + error.message, 'error');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists() && userDoc.data().role === 'admin') {
                    showMessage('loginMessage', 'Login successful!', 'success');
                    
                    setTimeout(() => {
                        loginScreen.classList.add('hidden');
                        adminDashboard.classList.remove('hidden');
                        userEmail.textContent = user.email;
                        loadDashboardData();
                        setupRealtimeListeners();
                    }, 1000);
                } else {
                    await auth.signOut();
                    showMessage('loginMessage', 'Access denied. Admin privileges required.', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('loginMessage', 'Login failed: ' + error.message, 'error');
            }
        });

        async function logout() {
            try {
                await auth.signOut();
                adminDashboard.classList.add('hidden');
                loginScreen.classList.remove('hidden');
                loginForm.reset();
                registerForm.reset();
                loginMessage.classList.add('hidden');
                registerMessage.classList.add('hidden');
                showLogin();
                
                users = [];
                products = [];
                orders = [];
                currentEditingId = null;
                
                console.log('Logout successful');
            } catch (error) {
                console.error('Logout error:', error);
                adminDashboard.classList.add('hidden');
                loginScreen.classList.remove('hidden');
                showLogin();
            }
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });

            document.querySelectorAll('.nav-links li').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            const titles = {
                'dashboard': 'Dashboard',
                'users': 'User Management',
                'products': 'Product Management',
                'orders': 'Order Management',
                'notifications': 'Send Notifications'
            };
            document.getElementById('sectionTitle').textContent = titles[sectionName];

            switch(sectionName) {
                case 'users':
                    loadUsers();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'notifications':
                    loadUsersForNotifications();
                    loadSentNotifications();
                    break;
            }
        }

        function setupRealtimeListeners() {
            db.collection('users').onSnapshot((snapshot) => {
                loadDashboardData();
                if (!document.getElementById('usersSection').classList.contains('hidden')) {
                    loadUsers();
                }
            });

            db.collection('products').onSnapshot((snapshot) => {
                loadDashboardData();
                if (!document.getElementById('productsSection').classList.contains('hidden')) {
                    loadProducts();
                }
            });

            db.collection('orders').onSnapshot((snapshot) => {
                loadDashboardData();
                if (!document.getElementById('ordersSection').classList.contains('hidden')) {
                    loadOrders();
                }
            });
        }

        async function loadDashboardData() {
            try {
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('totalUsers').textContent = usersSnapshot.size;

                const productsSnapshot = await db.collection('products').get();
                document.getElementById('totalProducts').textContent = productsSnapshot.size;

                const ordersSnapshot = await db.collection('orders').get();
                document.getElementById('totalOrders').textContent = ordersSnapshot.size;

                let revenue = 0;
                const recentOrdersTable = document.getElementById('recentOrders');
                recentOrdersTable.innerHTML = '';

                if (ordersSnapshot.empty) {
                    recentOrdersTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No orders found</td></tr>';
                } else {
                    const recentOrders = [];
                    ordersSnapshot.forEach(doc => {
                        const order = { id: doc.id, ...doc.data() };
                        recentOrders.push(order);
                        revenue += parseFloat(order.totalAmount || 0);
                    });
                    
                    recentOrders.sort((a, b) => new Date(b.createdAt?.toDate?.()) - new Date(a.createdAt?.toDate?.()));
                    const displayOrders = recentOrders.slice(0, 5);
                    
                    displayOrders.forEach(order => {
                        const row = recentOrdersTable.insertRow();
                        // FIXED: Get customer name from user data
                        const customerInfo = getCustomerInfo(order);
                        row.innerHTML = '<td>#' + order.id.slice(-8) + '</td><td>' + customerInfo.name + '</td><td>' + (order.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</td><td>$' + parseFloat(order.totalAmount || 0).toFixed(2) + '</td><td><span class="status-badge status-' + (order.status || 'pending') + '">' + (order.status || 'Pending') + '</span></td><td><button onclick="viewOrder(\'' + order.id + '\')" class="btn btn-primary">View</button></td>';
                    });
                }

                document.getElementById('totalRevenue').textContent = '$' + revenue.toFixed(2);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                document.getElementById('recentOrders').innerHTML = '<tr><td colspan="6" class="error">Error loading orders: ' + error.message + '</td></tr>';
            }
        }

        // NEW FUNCTION: Get customer info from user data
        async function getCustomerInfo(order) {
            if (order.customerName && order.customerEmail) {
                return { name: order.customerName, email: order.customerEmail };
            }
            
            if (order.userId) {
                try {
                    const userDoc = await db.collection('users').doc(order.userId).get();
                    if (userDoc.exists) {
                        const user = userDoc.data();
                        return { 
                            name: user.displayName || 'Unknown User', 
                            email: user.email || 'No email' 
                        };
                    }
                } catch (error) {
                    console.error('Error fetching user:', error);
                }
            }
            
            return { name: 'Unknown Customer', email: 'No email' };
        }

        async function loadUsers() {
            try {
                const usersSnapshot = await db.collection('users').get();
                users = [];
                const usersTable = document.getElementById('usersTable');
                usersTable.innerHTML = '';

                if (usersSnapshot.empty) {
                    usersTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No users found</td></tr>';
                    return;
                }

                usersSnapshot.forEach(doc => {
                    const user = { id: doc.id, ...doc.data() };
                    users.push(user);
                    
                    const row = usersTable.insertRow();
                    row.innerHTML = '<td>' + (user.displayName || 'N/A') + '</td><td>' + user.email + '</td><td><span class="status-badge status-' + (user.role || 'user') + '">' + (user.role || 'user') + '</span></td><td><span class="status-badge status-active">Active</span></td><td>' + (user.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</td><td><button onclick="viewUserDetails(\'' + doc.id + '\')" class="btn btn-info">Details</button> <button onclick="editUser(\'' + doc.id + '\')" class="btn btn-warning">Edit</button> <button onclick="deleteUser(\'' + doc.id + '\')" class="btn btn-danger">Delete</button></td>';
                });
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersTable').innerHTML = '<tr><td colspan="6" class="error">Error loading users: ' + error.message + '</td></tr>';
            }
        }

        async function viewUserDetails(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    
                    let userDetails = '<div class="user-details"><h4>User Information</h4><p><strong>User ID:</strong> ' + userId + '</p><p><strong>Display Name:</strong> ' + (user.displayName || 'Not set') + '</p><p><strong>Email:</strong> ' + user.email + '</p><p><strong>Role:</strong> ' + (user.role || 'user') + '</p><p><strong>Account Created:</strong> ' + (user.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</p></div>';

                    if (user.phone) userDetails += '<p><strong>Phone:</strong> ' + user.phone + '</p>';
                    if (user.address) userDetails += '<p><strong>Address:</strong> ' + user.address + '</p>';
                    if (user.lastLogin) userDetails += '<p><strong>Last Login:</strong> ' + (user.lastLogin?.toDate?.().toLocaleString() || 'N/A') + '</p>';

                    document.getElementById('userDetailsContent').innerHTML = userDetails;
                    document.getElementById('userDetailsModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading user details:', error);
                alert('Error loading user details: ' + error.message);
            }
        }

        function closeUserDetailsModal() {
            document.getElementById('userDetailsModal').style.display = 'none';
        }

        function showAddUserModal() {
            currentEditingId = null;
            document.getElementById('userModalTitle').textContent = 'Add New User';
            document.getElementById('userForm').reset();
            document.getElementById('passwordField').style.display = 'block';
            document.getElementById('userPassword').required = true;
            document.getElementById('userModal').style.display = 'block';
        }

        async function editUser(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    currentEditingId = userId;
                    
                    document.getElementById('userModalTitle').textContent = 'Edit User';
                    document.getElementById('userId').value = userId;
                    document.getElementById('userDisplayName').value = user.displayName || '';
                    document.getElementById('userEmailInput').value = user.email || '';
                    document.getElementById('userRole').value = user.role || 'user';
                    
                    document.getElementById('passwordField').style.display = 'none';
                    document.getElementById('userPassword').required = false;
                    
                    document.getElementById('userModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading user:', error);
                alert('Error loading user data');
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        document.getElementById('userForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userData = {
                displayName: document.getElementById('userDisplayName').value,
                email: document.getElementById('userEmailInput').value,
                role: document.getElementById('userRole').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                if (currentEditingId) {
                    await db.collection('users').doc(currentEditingId).update(userData);
                    alert('User updated successfully!');
                } else {
                    alert('User creation through admin panel requires Firebase Auth integration. Please create users through your main app or Firebase console.');
                }
                
                closeUserModal();
                loadUsers();
            } catch (error) {
                console.error('Error saving user:', error);
                alert('Error saving user: ' + error.message);
            }
        });

        async function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                try {
                    await db.collection('users').doc(userId).delete();
                    alert('User deleted successfully');
                    loadUsers();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user: ' + error.message);
                }
            }
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const filteredUsers = users.filter(user => 
                (user.displayName || '').toLowerCase().includes(searchTerm) ||
                (user.email || '').toLowerCase().includes(searchTerm)
            );
            
            const usersTable = document.getElementById('usersTable');
            usersTable.innerHTML = '';

            if (filteredUsers.length === 0) {
                usersTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No users found</td></tr>';
                return;
            }

            filteredUsers.forEach(user => {
                const row = usersTable.insertRow();
                row.innerHTML = '<td>' + (user.displayName || 'N/A') + '</td><td>' + user.email + '</td><td><span class="status-badge status-' + (user.role || 'user') + '">' + (user.role || 'user') + '</span></td><td><span class="status-badge status-active">Active</span></td><td>' + (user.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</td><td><button onclick="viewUserDetails(\'' + user.id + '\')" class="btn btn-info">Details</button> <button onclick="editUser(\'' + user.id + '\')" class="btn btn-warning">Edit</button> <button onclick="deleteUser(\'' + user.id + '\')" class="btn btn-danger">Delete</button></td>';
            });
        }

        async function loadProducts() {
            try {
                const productsSnapshot = await db.collection('products').get();
                products = [];
                const productsTable = document.getElementById('productsTable');
                productsTable.innerHTML = '';

                if (productsSnapshot.empty) {
                    productsTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No products found</td></tr>';
                    return;
                }

                productsSnapshot.forEach(doc => {
                    const product = { id: doc.id, ...doc.data() };
                    products.push(product);
                    
                    const row = productsTable.insertRow();
                    row.innerHTML = '<td>' + (product.name || 'N/A') + '</td><td>$' + parseFloat(product.price || 0).toFixed(2) + '</td><td>' + (product.stock || 0) + '</td><td>' + (product.category || 'N/A') + '</td><td><span class="status-badge ' + ((product.stock || 0) > 0 ? 'status-active' : 'status-cancelled') + '">' + ((product.stock || 0) > 0 ? 'In Stock' : 'Out of Stock') + '</span></td><td><button onclick="editProduct(\'' + doc.id + '\')" class="btn btn-warning">Edit</button> <button onclick="deleteProduct(\'' + doc.id + '\')" class="btn btn-danger">Delete</button></td>';
                });
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsTable').innerHTML = '<tr><td colspan="6" class="error">Error loading products: ' + error.message + '</td></tr>';
            }
        }

        function showAddProductModal() {
            currentEditingId = null;
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').style.display = 'block';
        }

        async function editProduct(productId) {
            try {
                const productDoc = await db.collection('products').doc(productId).get();
                if (productDoc.exists) {
                    const product = productDoc.data();
                    currentEditingId = productId;
                    
                    document.getElementById('productModalTitle').textContent = 'Edit Product';
                    document.getElementById('productId').value = productId;
                    document.getElementById('productName').value = product.name || '';
                    document.getElementById('productDescription').value = product.description || '';
                    document.getElementById('productPrice').value = product.price || '';
                    document.getElementById('productStock').value = product.stock || '';
                    document.getElementById('productCategory').value = product.category || '';
                    document.getElementById('productImage').value = product.imageUrl || '';
                    
                    document.getElementById('productModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading product:', error);
                alert('Error loading product data');
            }
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                category: document.getElementById('productCategory').value,
                imageUrl: document.getElementById('productImage').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (!currentEditingId) {
                productData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            }

            try {
                if (currentEditingId) {
                    await db.collection('products').doc(currentEditingId).update(productData);
                    alert('Product updated successfully!');
                } else {
                    await db.collection('products').add(productData);
                    alert('Product created successfully!');
                }
                
                closeProductModal();
                loadProducts();
            } catch (error) {
                console.error('Error saving product:', error);
                alert('Error saving product: ' + error.message);
            }
        });

        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                try {
                    await db.collection('products').doc(productId).delete();
                    alert('Product deleted successfully');
                    loadProducts();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product: ' + error.message);
                }
            }
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const filteredProducts = products.filter(product => 
                (product.name || '').toLowerCase().includes(searchTerm) ||
                (product.category || '').toLowerCase().includes(searchTerm)
            );
            
            const productsTable = document.getElementById('productsTable');
            productsTable.innerHTML = '';

            if (filteredProducts.length === 0) {
                productsTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No products found</td></tr>';
                return;
            }

            filteredProducts.forEach(product => {
                const row = productsTable.insertRow();
                row.innerHTML = '<td>' + (product.name || 'N/A') + '</td><td>$' + parseFloat(product.price || 0).toFixed(2) + '</td><td>' + (product.stock || 0) + '</td><td>' + (product.category || 'N/A') + '</td><td><span class="status-badge ' + ((product.stock || 0) > 0 ? 'status-active' : 'status-cancelled') + '">' + ((product.stock || 0) > 0 ? 'In Stock' : 'Out of Stock') + '</span></td><td><button onclick="editProduct(\'' + product.id + '\')" class="btn btn-warning">Edit</button> <button onclick="deleteProduct(\'' + product.id + '\')" class="btn btn-danger">Delete</button></td>';
            });
        }

        // FIXED: Load orders with proper customer names
        async function loadOrders() {
            try {
                const ordersSnapshot = await db.collection('orders').get();
                orders = [];
                const ordersTable = document.getElementById('ordersTable');
                ordersTable.innerHTML = '';

                if (ordersSnapshot.empty) {
                    ordersTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #7f8c8d;">No orders found</td></tr>';
                    return;
                }

                // Get all users to map user IDs to names
                const usersSnapshot = await db.collection('users').get();
                const userMap = {};
                usersSnapshot.forEach(doc => {
                    userMap[doc.id] = doc.data();
                });

                ordersSnapshot.forEach(doc => {
                    const order = { id: doc.id, ...doc.data() };
                    orders.push(order);
                    
                    // Get customer info
                    let customerName = 'Unknown Customer';
                    let customerEmail = 'No email';
                    
                    if (order.customerName && order.customerEmail) {
                        customerName = order.customerName;
                        customerEmail = order.customerEmail;
                    } else if (order.userId && userMap[order.userId]) {
                        const user = userMap[order.userId];
                        customerName = user.displayName || 'Unknown User';
                        customerEmail = user.email || 'No email';
                    }
                    
                    const row = ordersTable.insertRow();
                    row.innerHTML = '<td>#' + doc.id.slice(-8) + '</td><td>' + customerName + '</td><td>' + customerEmail + '</td><td>' + (order.items?.length || 0) + ' items</td><td>$' + parseFloat(order.totalAmount || 0).toFixed(2) + '</td><td><span class="status-badge status-' + (order.status || 'pending') + '">' + (order.status || 'Pending') + '</span></td><td>' + (order.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</td><td><button onclick="viewOrder(\'' + doc.id + '\')" class="btn btn-primary">View</button> <button onclick="updateOrderStatus(\'' + doc.id + '\')" class="btn btn-warning">Update Status</button></td>';
                });
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('ordersTable').innerHTML = '<tr><td colspan="8" class="error">Error loading orders: ' + error.message + '</td></tr>';
            }
        }

        async function viewOrder(orderId) {
            try {
                const orderDoc = await db.collection('orders').doc(orderId).get();
                if (orderDoc.exists) {
                    const order = orderDoc.data();
                    
                    // Get customer info for order details
                    const customerInfo = await getCustomerInfo(order);
                    
                    let orderDetails = '<h4>Order #' + orderId.slice(-8) + '</h4><p><strong>Customer:</strong> ' + customerInfo.name + '</p><p><strong>Email:</strong> ' + customerInfo.email + '</p><p><strong>Date:</strong> ' + (order.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</p><p><strong>Status:</strong> <span class="status-badge status-' + (order.status || 'pending') + '">' + (order.status || 'Pending') + '</span></p><p><strong>Total Amount:</strong> $' + parseFloat(order.totalAmount || 0).toFixed(2) + '</p>';
                    
                    if (order.items && order.items.length > 0) {
                        orderDetails += '<h5>Order Items:</h5><ul>';
                        order.items.forEach(item => {
                            orderDetails += '<li>' + (item.name || 'Product') + ' - $' + parseFloat(item.price || 0).toFixed(2) + ' x ' + (item.quantity || 1) + '</li>';
                        });
                        orderDetails += '</ul>';
                    }
                    
                    if (order.shippingAddress) {
                        orderDetails += '<h5>Shipping Address:</h5><p>' + order.shippingAddress + '</p>';
                    }
                    
                    document.getElementById('orderDetails').innerHTML = orderDetails;
                    document.getElementById('orderModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading order:', error);
                alert('Error loading order details');
            }
        }

        async function updateOrderStatus(orderId) {
            const newStatus = prompt('Enter new status (pending, processing, completed, cancelled):');
            if (newStatus && ['pending', 'processing', 'completed', 'cancelled'].includes(newStatus)) {
                try {
                    await db.collection('orders').doc(orderId).update({
                        status: newStatus,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Order status updated successfully!');
                    loadOrders();
                } catch (error) {
                    console.error('Error updating order:', error);
                    alert('Error updating order status');
                }
            } else if (newStatus) {
                alert('Invalid status. Please use: pending, processing, completed, or cancelled');
            }
        }

        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        function searchOrders() {
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            const statusFilter = document.getElementById('orderStatusFilter').value;
            
            const filteredOrders = orders.filter(order => {
                const customerName = getCustomerNameFromOrder(order);
                const matchesSearch = customerName.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || (order.status || 'pending') === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            const ordersTable = document.getElementById('ordersTable');
            ordersTable.innerHTML = '';

            if (filteredOrders.length === 0) {
                ordersTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #7f8c8d;">No orders found</td></tr>';
                return;
            }

            filteredOrders.forEach(order => {
                const customerInfo = getCustomerInfoSync(order);
                const row = ordersTable.insertRow();
                row.innerHTML = '<td>#' + order.id.slice(-8) + '</td><td>' + customerInfo.name + '</td><td>' + customerInfo.email + '</td><td>' + (order.items?.length || 0) + ' items</td><td>$' + parseFloat(order.totalAmount || 0).toFixed(2) + '</td><td><span class="status-badge status-' + (order.status || 'pending') + '">' + (order.status || 'Pending') + '</span></td><td>' + (order.createdAt?.toDate?.().toLocaleDateString() || 'N/A') + '</td><td><button onclick="viewOrder(\'' + order.id + '\')" class="btn btn-primary">View</button> <button onclick="updateOrderStatus(\'' + order.id + '\')" class="btn btn-warning">Update Status</button></td>';
            });
        }

        // Helper function to get customer name from order (sync version for search)
        function getCustomerInfoSync(order) {
            if (order.customerName && order.customerEmail) {
                return { name: order.customerName, email: order.customerEmail };
            }
            
            // For search, we use the pre-loaded user data
            if (order.userId && users.length > 0) {
                const user = users.find(u => u.id === order.userId);
                if (user) {
                    return { 
                        name: user.displayName || 'Unknown User', 
                        email: user.email || 'No email' 
                    };
                }
            }
            
            return { name: 'Unknown Customer', email: 'No email' };
        }

        function getCustomerNameFromOrder(order) {
            const customerInfo = getCustomerInfoSync(order);
            return customerInfo.name;
        }

        function filterOrders() {
            searchOrders();
        }

        function toggleUserSelection() {
            const recipientType = document.getElementById('notificationRecipient').value;
            const userSelectionContainer = document.getElementById('userSelectionContainer');
            
            if (recipientType === 'single') {
                userSelectionContainer.style.display = 'block';
            } else {
                userSelectionContainer.style.display = 'none';
            }
        }

        async function loadUsersForNotifications() {
            try {
                const usersSnapshot = await db.collection('users').get();
                const userSelect = document.getElementById('notificationUser');
                userSelect.innerHTML = '<option value="">Select a user</option>';
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = (user.displayName || 'Unknown') + ' (' + user.email + ')';
                    userSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading users for notifications:', error);
                document.getElementById('notificationUser').innerHTML = '<option value="">Error loading users</option>';
            }
        }

        async function loadSentNotifications() {
            try {
                const notificationsSnapshot = await db.collection('adminNotifications').get();
                const notificationsTable = document.getElementById('notificationsTable');
                notificationsTable.innerHTML = '';

                if (notificationsSnapshot.empty) {
                    notificationsTable.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #7f8c8d;">No notifications sent yet</td></tr>';
                    return;
                }

                notificationsSnapshot.forEach(doc => {
                    const notification = doc.data();
                    const row = notificationsTable.insertRow();
                    
                    let recipientText = 'All Users';
                    if (notification.recipientType === 'single' && notification.recipientUserId) {
                        recipientText = 'Single User';
                    }
                    
                    row.innerHTML = '<td>' + (notification.title || 'No Title') + '</td><td>' + (notification.message || 'No Message') + '</td><td>' + recipientText + '</td><td><span class="status-badge status-' + (notification.type || 'info') + '">' + (notification.type || 'info') + '</span></td><td>' + (notification.sentAt?.toDate?.().toLocaleString() || 'N/A') + '</td>';
                });
            } catch (error) {
                console.error('Error loading notifications:', error);
                document.getElementById('notificationsTable').innerHTML = '<tr><td colspan="5" class="error">Error loading notifications</td></tr>';
            }
        }

        // FIXED: Notification system - stores notifications in user-specific collections
        document.getElementById('notificationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const recipientType = document.getElementById('notificationRecipient').value;
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            const type = document.getElementById('notificationType').value;
            
            let recipientUserId = null;
            if (recipientType === 'single') {
                recipientUserId = document.getElementById('notificationUser').value;
                if (!recipientUserId) {
                    alert('Please select a user');
                    return;
                }
            }

            try {
                const notificationData = {
                    title: title,
                    message: message,
                    type: type,
                    isRead: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    sentBy: auth.currentUser.uid,
                    sentByEmail: auth.currentUser.email
                };

                // Store in adminNotifications for admin records
                const adminNotificationData = {
                    ...notificationData,
                    recipientType: recipientType,
                    recipientUserId: recipientUserId,
                    sentAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('adminNotifications').add(adminNotificationData);

                if (recipientUserId) {
                    // Send to single user - store in their userNotifications collection
                    await db.collection('userNotifications').doc(recipientUserId).collection('notifications').add(notificationData);
                    alert('Notification sent to user successfully!');
                } else {
                    // Send to all users
                    const usersSnapshot = await db.collection('users').get();
                    let sentCount = 0;
                    
                    const batch = db.batch();
                    usersSnapshot.forEach(doc => {
                        const userNotificationRef = db.collection('userNotifications').doc(doc.id).collection('notifications').doc();
                        batch.set(userNotificationRef, notificationData);
                        sentCount++;
                    });
                    
                    await batch.commit();
                    alert('Notification sent to ' + sentCount + ' users successfully!');
                }
                
                // Reset form and reload notifications
                document.getElementById('notificationForm').reset();
                loadSentNotifications();
                
            } catch (error) {
                console.error('Error sending notification:', error);
                alert('Error sending notification: ' + error.message);
            }
        });

        auth.onAuthStateChanged((user) => {
            if (user) {
                db.collection('users').doc(user.uid).get().then((doc) => {
                    if (doc.exists && doc.data().role === 'admin') {
                        loginScreen.classList.add('hidden');
                        adminDashboard.classList.remove('hidden');
                        userEmail.textContent = user.email;
                        loadDashboardData();
                        setupRealtimeListeners();
                    } else {
                        auth.signOut();
                        loginScreen.classList.remove('hidden');
                        adminDashboard.classList.add('hidden');
                        showMessage('loginMessage', 'Access denied. Admin privileges required.', 'error');
                    }
                }).catch((error) => {
                    console.error('Error checking admin status:', error);
                    auth.signOut();
                    loginScreen.classList.remove('hidden');
                    adminDashboard.classList.add('hidden');
                });
            } else {
                loginScreen.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
            }
        });
    </script>
</body>
</html>